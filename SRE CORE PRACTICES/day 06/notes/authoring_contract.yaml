authoring_contract:
  response_schema:
    headings_in_order:
      - "ğŸ¯ Learning Objective"
      - "âœ… Takeaway"
      - "Prose"
      - "Image Embed"          # markdown ![] or mermaid block
    panel_json_schema:
      required_fields:
        - panel
        - filename
        - scene_description
        - speech_bubbles
        - narration

  prose_requirements:
    word_band:
      min: 7500
      max: 10000
    chunk_size:
      min: 400        # each prose block 300â€“500 words
      max: 600
    perspective: "second-person teacher + narrative examples"

  format_rules:               # ğŸ†• ensures â€œhybrid graphic-novelâ€ cadence
    cadence:
      description: "Alternate prose blocks and sequential-art panels."
      pattern: |
        (Prose â†’ Image Embed)+     # e.g., P I P I â€¦ may end with Prose
      max_consecutive_prose: 1     # never two prose chunks without a panel
      max_consecutive_images: 1    # no image spam without narrative
    panel_ratio:
      min_images: 8
      max_images: 15
      check: "Total images within word_band must satisfy min_images â‰¤ n â‰¤ max_images"

  visual_guidelines:
    palette_style_ref: "house_palette_line_style.md"
    prefer_diagrams: "mermaid"
    character_presence:
      primary: "ava"
      rule: "At least 50 % of panels include Ava to anchor teaching voice"

  consistency_checklist:
    - "Headings present & in required order"
    - "Word count within 7 500â€“10 000 band"
    - "Cadence pattern Pâ†’I alternation satisfied"
    - "Image count 8â€“15"
    - "Mermaid diagrams as â€œinline diagramsâ€ that donâ€™t count against the static-panel quota"
    - "Panel JSON matches schema, all images referenced"
    - "Mermaid blocks compile"
    - "Ava appears in â‰¥ 50 % panels"

  escalation_rule: |
    If any checklist item fails, return the checklist table with âŒ items and halt content generation until resolved.
