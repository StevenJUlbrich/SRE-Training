authoring_contract:
  response_schema:
    headings_in_order:
      - "🎯 Learning Objective"
      - "✅ Takeaway"
      - "Prose"
      - "Image Embed"
    panel_json_schema:
      required_fields:
        - panel
        - filename
        - scene_description
        - speech_bubbles
        - narration
  prose_requirements:
    word_band:
      min: 7800
      max: 10000
    chunk_size:
      min: 400
      max: 600
    perspective: "second-person teacher + narrative examples"
    prose_style: |
      Fully narrative, conversational, detailed, and engaging; explicitly avoid bullet points or lists unless requested.
      Integrate storytelling elements, vivid descriptions, and Kenyan analogies or cultural references where appropriate.
  format_rules:
    cadence:
      description: "Alternate detailed narrative prose blocks and clearly described sequential-art panels."
      pattern: |
        (Prose → Image Embed)+
      max_consecutive_prose: 1
      max_consecutive_images: 1
    panel_ratio:
      min_images: 8
      max_images: 15
      check: "Total images within word_band must satisfy min_images ≤ n ≤ max_images"
  visual_guidelines:
    palette_style_ref: "house_palette_line_style.md"
    prefer_diagrams: "mermaid"
    character_presence:
      primary: "ava"
      rule: "At least 50 % of panels include Ava to anchor teaching voice"
  consistency_checklist:
    - "Headings present & in required order"
    - "Word count within 7000–10000 band"
    - "Cadence pattern P→I alternation satisfied"
    - "Image count 6–15"
    - "Mermaid diagrams as 'inline diagrams' that don't count against the static-panel quota"
    - "Panel JSON matches schema, all images referenced"
    - "Mermaid blocks compile"
    - "Ava appears in ≥ 50 % panels"
    - "Prose explicitly detailed, narrative, without superficial summaries or excessive bullet points"
  ambiguity_handling:
    explicit_instruction: |
      If uncertain about the level of detail required, explicitly pause and request clarification—never default to condensed or overly summarized output.
  escalation_rule: |
    If any checklist item fails, return the checklist table with ❌ items and halt content generation until resolved.